<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />

    <title>Scalable URL Shortener</title>
  </head>

  <body>
    <div class="container mt-4">

      <h1 class="mb-2">Scalable URL Shortener</h1>
      <p class="text-muted">
        Backend service with analytics, expiry handling, and validation
      </p>

      <!-- FORM -->
      <form action="/shorturls" method="POST" class="my-4">
        <div class="input-group">
          <input
            type="url"
            name="fullUrl"
            id="fullUrl"
            class="form-control"
            placeholder="Enter a long URL"
            required
          />
          <button class="btn btn-success px-4" type="submit">
            Shorten
          </button>
        </div>
      </form>

      <!-- TABLE -->
      <table class="table table-striped table-hover table-bordered table-sm align-middle">
        <thead class="table-dark">
          <tr>
            <th>Full URL</th>
            <th>Short URL</th>
            <th>Clicks</th>
            <th>Expires At</th>
            <th>Delete</th>
          </tr>
        </thead>

        <tbody>
          <% shorturls.forEach(shorturl => { %>
            <tr>
              <!-- Full URL -->
              <td>
                <a href="<%= shorturl.full %>" target="_blank">
                  <%= shorturl.full %>
                </a>
              </td>

              <!-- Short URL -->
              <td>
                <a
                  href="http://localhost:5000/<%= shorturl.short %>"
                  target="_blank"
                >
                  http://localhost:5000/<%= shorturl.short %>
                </a>
              </td>

              <!-- Clicks -->
              <td><%= shorturl.clicks %></td>

              <!-- Expiry -->
              <td>
                <% if (shorturl.expiresAt) { %>
                  <span class="badge bg-warning text-dark">
                    <%= shorturl.expiresAt.toDateString() %>
                  </span>
                <% } else { %>
                  <span class="badge bg-success">Never</span>
                <% } %>
              </td>

              <!-- Delete -->
              <td>
                <form method="POST" action="/<%= shorturl._id %>">
                  <button class="btn btn-danger btn-sm" type="submit">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

    </div>
  </body>
</html>
